<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GlowSalon Booking</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="firebase.js"></script>
</head>
<body>
  <!-- Header -->
  <header>
    <h1>GlowSalon</h1>
    <p class="tagline">Your style, your shine ✨</p>
    <a href="admin.html" class="admin-btn">Admin Login</a>
  </header>

  <!-- Booking Form -->
  <div id="bookingContainer" class="card">
    <h2>Book Your Service</h2>
    <label for="serviceSelect">Choose a service:</label>
    <select id="serviceSelect"></select>

    <input type="text" id="nameInput" placeholder="Your Name">
    <input type="text" id="phoneInput" placeholder="Phone Number">

    <button id="joinQueueBtn">Join Queue</button>
  </div>

  <!-- Footer -->
  <footer>
    <p>Built with ❤ by <strong>Kipkoech Emmanuel</strong></p>
  </footer>

  <script>
    // Services list
    const SERVICES = [
      {id:'haircut', name:'Haircut', duration:20},
      {id:'braids', name:'Braids', duration:180},
      {id:'manicure', name:'Manicure', duration:45},
      {id:'beard', name:'Beard Trim', duration:15},
    ];

    const serviceSelect = document.getElementById('serviceSelect');
    SERVICES.forEach(s => {
      const option = document.createElement('option');
      option.value = s.id;
      option.textContent = s.name;
      serviceSelect.appendChild(option);
    });

    // Booking function
    document.getElementById('joinQueueBtn').addEventListener('click', async () => {
      const name = document.getElementById('nameInput').value.trim();
      const phone = document.getElementById('phoneInput').value.trim();
      const serviceId = serviceSelect.value;
      const serviceName = SERVICES.find(s => s.id === serviceId).name;

      if(!name || !phone) return alert('Enter name and phone number');

      try {
        // Add to queue
        const docRef = await db.collection('queue').add({
          name,
          phone,
          service: serviceName,
          status: 'waiting',
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        // Get position in queue
        const snapshot = await db.collection('queue')
          .where('status', '==', 'waiting')
          .orderBy('createdAt')
          .get();

        let position = 0;
        snapshot.forEach((doc, index) => {
          if(doc.id === docRef.id) position = index + 1;
        });

        alert(`You have joined the queue! Your position is ${position}.`);

        document.getElementById('nameInput').value = '';
        document.getElementById('phoneInput').value = '';
      } catch(err) {
        console.error(err);
        alert('Failed to join queue. Check Firebase rules and internet connection.');
      }
    });
  </script>
</body>
</html>
